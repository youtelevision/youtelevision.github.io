<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTelevision</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 1em;
      background-color: #202020;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    input[type="text"] {
      width: 60%;
      padding: 0.5em;
      font-size: 1em;
      border: none;
      border-radius: 5px;
    }
    button {
      padding: 0.5em 1em;
      margin-left: 10px;
      background-color: #FF0000;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .videos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1em;
      padding: 1em;
    }
    .video {
      background-color: #181818;
      padding: 1em;
      border-radius: 8px;
    }
    .video iframe {
      width: 100%;
      height: 200px;
      border-radius: 5px;
    }
    .video h4 {
      margin: 0.5em 0 0;
    }
  </style>
</head>
<body>

<header>
  <h1>YouTV</h1>
  <div>
    <input type="text" id="searchInput" placeholder="Search YouTube...">
    <button onclick="startSearch()">Search</button>
  </div>
</header>

<main class="videos" id="videoContainer">Loading videos...</main>

<script>
const API_KEY = 'AIzaSyDeI8KBaKlngQuTycPDCu4uC6ogNuTVLAs';
const videoContainer = document.getElementById('videoContainer');

let nextPageToken = '';
let currentQuery = '';
let currentMode = 'popular'; // or 'search'
let isLoading = false;

function createVideoCard(video) {
  const videoId = video.id.videoId || video.id;
  const title = video.snippet.title;
  const channel = video.snippet.channelTitle;
  const iframe = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
  return `
    <div class="video">
      ${iframe}
      <h4>${title}</h4>
      <p>by ${channel}</p>
    </div>
  `;
}

function displayVideos(videos) {
  const html = videos.map(createVideoCard).join('');
  videoContainer.innerHTML += html;
}

async function fetchVideos(url) {
  if (isLoading) return;
  isLoading = true;

  try {
    const response = await fetch(url);
    const data = await response.json();

    nextPageToken = data.nextPageToken || '';
    if (data.items && data.items.length > 0) {
      displayVideos(data.items);
    } else {
      videoContainer.innerHTML += '<p>No videos found.</p>';
    }
  } catch (error) {
    console.error('Fetch error:', error);
    videoContainer.innerHTML += '<p>Error loading videos.</p>';
  }

  isLoading = false;
}

function loadMore() {
  let url = '';
  if (currentMode === 'popular') {
    url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=12&pageToken=${nextPageToken}&regionCode=US&key=${API_KEY}`;
  } else {
    url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=12&pageToken=${nextPageToken}&q=${encodeURIComponent(currentQuery)}&key=${API_KEY}`;
  }

  fetchVideos(url);
}

function startSearch() {
  currentQuery = document.getElementById('searchInput').value;
  currentMode = currentQuery ? 'search' : 'popular';
  nextPageToken = '';
  videoContainer.innerHTML = '';
  loadMore();
}

function handleScroll() {
  const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
  if (scrollTop + clientHeight >= scrollHeight - 200) {
    loadMore();
  }
}

window.addEventListener('scroll', handleScroll);

// Load popular videos on startup
startSearch();
</script>

</body>
</html>
